/*
# CheckMate Feature Validation Workflow

This rule enforces a standard workflow when asked to use CheckMate to validate that a feature is working correctly.
*/

const workflowRule = {
  name: "CheckMate Feature Validation Workflow",
  description: "Enforce a consistent process for validating features with CheckMate",
  run: async ({ cursor }) => {
    // Define the workflow steps in the ruleset
    const workflowSteps = [
      "1. Check if a spec exists for the feature being validated",
      "2. If no spec exists, suggest creating one and wait for user confirmation",
      "3. Create the spec in checkmate/specs/ directory (NOT in root)",
      "4. Use the audit command to verify implementation against spec",
      "5. If audit fails, attempt fixes until reaching max_attempts (from .checkmate)",
      "6. Report final status with detailed breakdown of passing and failing checks"
    ];

    // Feature spec location rules
    const specLocationRules = [
      "- All CheckMate specs MUST be stored in the checkmate/specs/ directory",
      "- Specs should use kebab-case for filenames (e.g., feature-name.md)",
      "- Agent specs should be placed in checkmate/specs/agents/ subdirectory"
    ];

    // Auto-fix enforcement rules
    const autoFixRules = [
      "- When a feature validation FAILS, ALWAYS continue fixing until max_attempts is reached",
      "- Track fix attempts with a counter and continue until max_attempts (5 by default)",
      "- Each fix attempt should address specific failing checks with targeted changes",
      "- After each fix attempt, rerun audit to check if all checks now pass",
      "- Only stop fixing when either all checks PASS or max_attempts is reached"
    ];

    console.log("Following CheckMate Feature Validation Workflow:");
    console.log(workflowSteps.join("\n"));
    console.log("\nSpec Location Rules:");
    console.log(specLocationRules.join("\n"));
    console.log("\nAuto-Fix Enforcement Rules:");
    console.log(autoFixRules.join("\n"));

    return {
      success: true,
      message: "Remember to follow the CheckMate Feature Validation Workflow with continuous fix attempts"
    };
  }
};

export default workflowRule;